<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RingGo</title>
<style>
  :root{--pink:#f5007a;}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;margin:0;background:#f6f7fb;color:#111}
  .wrap{max-width:780px;margin:24px auto;padding:0 16px}
  h1{color:var(--pink);margin:8px 0 4px;font-size:36px}
  .muted{color:#505257}
  .card{background:#fff;border-radius:18px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,.06);margin:18px 0}
  .field{display:flex;flex-direction:column;gap:8px;margin:10px 0}
  .field label{font-weight:600}
  .field input{padding:14px 12px;border:1px solid #dcdde4;border-radius:12px;font-size:16px;background:#fff}
  .btn{border:0;border-radius:12px;padding:14px 18px;background:linear-gradient(90deg,#ff2f9e,var(--pink));color:#fff;font-size:16px;cursor:pointer}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;white-space:nowrap}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>RingGo</h1>
      <p class="muted">Demo only – payments are simulated and saved locally.</p>
    </header>

    <section class="card">
      <h2 style="margin:0 0 8px;">Add payment</h2>
      <form id="payForm" autocomplete="off">
        <div class="field">
          <label for="loc">Location number (optional)</label>
          <input id="loc" name="loc" type="text" placeholder="e.g. L1 / 101" />
        </div>

        <div class="field">
          <label for="car">Car plate</label>
          <input id="car" name="car" type="text" placeholder="ABC-123" required />
        </div>

        <div class="field">
          <label for="time">Time (hh:mm)</label>
          <input id="time" name="time" type="text" placeholder="2:20" pattern="^([0-9]{1,2}):([0-5][0-9])$" required />
        </div>

        <div class="field">
          <label for="card">Card number</label>
          <input id="card" name="card" inputmode="numeric" maxlength="19" placeholder="#### #### #### ####" required />
        </div>

        <div style="display:flex;gap:12px">
          <div class="field" style="flex:1">
            <label for="exp">Exp</label>
            <input id="exp" name="exp" inputmode="numeric" placeholder="MM/YY" required />
          </div>
          <div class="field" style="flex:1">
            <label for="cvv">CVV</label>
            <input id="cvv" name="cvv" inputmode="numeric" maxlength="4" placeholder="***" required />
          </div>
        </div>

        <div style="display:flex;justify-content:flex-end;margin-top:18px">
          <button class="btn" type="submit">Pay</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h3 style="margin:0 0 12px;">Saved payments</h3>
      <div style="overflow:auto">
        <table id="table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Location</th>
              <th>Car</th>
              <th>Time</th>
              <th>Card last 4</th>
            </tr>
          </thead>
          <tbody id="tbody"><tr><td colspan="5" class="muted">No records yet.</td></tr></tbody>
        </table>
      </div>
    </section>
  </div>

<script>
(function(){
  const KEY = "park_quick_payments_v3";
  const $ = s => document.querySelector(s);

  const formatCard = v => v.replace(/\D/g,'').slice(0,16).replace(/(.{4})/g,'$1 ').trim();
  $('#card').addEventListener('input', e => e.target.value = formatCard(e.target.value));

  $('#exp').addEventListener('input', e => {
    let v = e.target.value.replace(/\D/g,'').slice(0,4);
    if(v.length>2) v = v.slice(0,2) + '/' + v.slice(2);
    e.target.value = v;
  });

  function load(){ try { return JSON.parse(localStorage.getItem(KEY) || '[]'); } catch { return []; } }
  function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

  function render(){
    const data = load();
    const tbody = $('#tbody');
    tbody.innerHTML = '';
    if(!data.length){
      tbody.innerHTML = '<tr><td colspan="5" class="muted">No records yet.</td></tr>';
      return;
    }
    data.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${new Date(r.createdAt).toLocaleString()}</td>
        <td>${r.loc || '-'}</td>
        <td>${r.car}</td>
        <td>${r.timeStr} (${r.totalMinutes} min)</td>
        <td>${r.cardLast4}</td>`;
      tbody.appendChild(tr);
    });
  }

  function last4(v){ return v.replace(/\D/g,'').slice(-4); }

  $('#payForm').addEventListener('submit', e=>{
    e.preventDefault();
    const loc = $('#loc').value.trim();
    const car = $('#car').value.trim();
    const timeStr = $('#time').value.trim();
    const match = timeStr.match(/^([0-9]{1,2}):([0-5][0-9])$/);
    if(!match){ alert("Invalid time format (use hh:mm)."); return; }
    const hours = parseInt(match[1],10);
    const minutes = parseInt(match[2],10);
    const totalMinutes = hours*60 + minutes;

    const card = $('#card').value.trim();
    const exp = $('#exp').value.trim();
    const cvv = $('#cvv').value.trim();

    if(!car || !timeStr || !card || !exp || !cvv){
      alert('Please complete all required fields.');
      return;
    }

    const record = {
      loc, car, timeStr, totalMinutes,
      cardLast4: last4(card),
      createdAt: Date.now()
    };

    const data = load();
    data.unshift(record);
    save(data);
    render();

    e.target.reset();
    alert('✅ Payment successful! Ref: ' + Math.floor(100000 + Math.random()*900000));
  });

  render();
})();
</script>
</body>
</html>
