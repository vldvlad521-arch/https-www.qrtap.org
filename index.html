<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QRtap Quick Parking</title>
  <style>
    :root { --bg:#0b1020; --card:#121726; --line:#1f2637; --text:#e8eefb; --muted:#9aa4b2; --accent:#21c48d; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text); }
    .wrap { max-width:860px; margin: 0 auto; padding: 20px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:20px; padding:24px; box-shadow:0 10px 28px rgba(0,0,0,.35) }
    h1 { margin:0 0 6px; font-size:28px }
    label { display:block; margin:14px 0 6px; font-weight:600 }
    input, select { width:100%; background:#0f1424; border:1px solid var(--line); color:var(--text); padding:14px; border-radius:12px; outline:none }
    .btn { display:inline-block; width:100%; text-align:center; border:0; border-radius:14px; padding:16px 18px; font-weight:800; cursor:pointer; background:var(--accent); color:#042c22; margin-top:16px }
    .hint { font-size:12px; color:#88a0b8; margin-top:6px }
    .row { display:grid; gap:12px; grid-template-columns: 1fr 1fr }
    @media (max-width:700px) { .row { grid-template-columns: 1fr } }
    .badge { display:inline-block; font-size:12px; background:#046e3b; border-radius:999px; padding:4px 10px; float:right }
    .toast { position:fixed; inset:auto 16px 16px 16px; background:#0e1526; border:1px solid var(--line); color:#8de0ea; padding:10px 14px; border-radius:10px; display:none }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>QRtap Quick Parking <span class="badge">qrtap.org</span></h1>
      <p class="hint">
        Fill in your details and press <b>Pay</b>. You’ll be sent to Worldpay’s secure page to enter your card.
        We do not store your data.
      </p>

      <form id="f" method="POST" action="https://secure.worldpay.com/wcc/purchase">
        <!-- 🔐 OBLIGATORII pentru Worldpay -->
        <input type="hidden" name="instId" id="instId" value="INST_ID_HERE" />
        <input type="hidden" name="currency" value="GBP" />
        <input type="hidden" name="amount" id="amount" value="" />
        <input type="hidden" name="cartId" id="cartId" value="" />
        <input type="hidden" name="desc" id="desc" value="" />
        <!-- NU pune testMode in LIVE -->

        <!-- Date pentru tine (nu se trimit ca pană la checkout) -->
        <label for="plate">Car plate number</label>
        <input id="plate" name="plate" placeholder="e.g. AB12 CDE" required />

        <label for="loc">Parking location (code or name)</label>
        <input id="loc" name="loc" placeholder="e.g. 35386 or street name" required />

        <div class="row">
          <div>
            <label for="dur">Duration</label>
            <select id="dur" name="dur" required>
              <option value="" disabled selected>Select...</option>
              <option value="0.5">30 min</option>
              <!-- 1 .. 48 hours -->
              <script>
                // inject options 1..48 via JS to keep HTML clean
                document.addEventListener('DOMContentLoaded', () => {
                  const s = document.getElementById('dur');
                  for (let h=1; h<=48; h++) {
                    const opt = document.createElement('option');
                    opt.value = String(h);
                    opt.textContent = `${h} hour${h>1?'s':''}`;
                    s.appendChild(opt);
                  }
                });
              </script>
            </select>
          </div>
        </div>

        <button type="submit" class="btn">Pay</button>
      </form>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // === PREȚURI (fără afișare pe pagină) ============================
    // 30 min = £2.00 ; 1h–48h = £4.00 / oră
    function calcAmount(hoursVal) {
      const h = parseFloat(hoursVal);
      if (isNaN(h)) return null;
      if (h === 0.5) return 2.00;
      return 4.00 * h;
    }

    // === UI helpers ===================================================
    function toast(msg, t=1500){ const el=document.getElementById('toast'); el.textContent=msg; el.style.display='block'; setTimeout(()=>el.style.display='none', t); }

    // === SUBMIT => către Worldpay ====================================
    document.getElementById('f').addEventListener('submit', (e) => {
      e.preventDefault();

      const instId = document.getElementById('instId').value.trim();
      if (!/^\d{5,10}$/.test(instId)) { toast('Worldpay Installation ID lipsă sau invalid.'); return; }

      const plate = document.getElementById('plate').value.trim();
      const loc   = document.getElementById('loc').value.trim();
      const dur   = document.getElementById('dur').value;
      if (!plate || !loc || !dur){ toast('Completează toate câmpurile.'); return; }

      const amount = calcAmount(dur);
      if (amount === null) { toast('Durată invalidă.'); return; }

      // setăm câmpurile Worldpay
      document.getElementById('amount').value = amount.toFixed(2);
      document.getElementById('desc').value   = `Parking ${plate} @ ${loc} (${dur}h)`;
      document.getElementById('cartId').value = `${Date.now()}-${plate.replace(/\s+/g,'')}`;

      e.target.submit(); // POST către Worldpay (pagina lor de card)
    });
  </script>
</body>
</html>
