<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parking Payment</title>

  <!-- üîë √énlocuie»ôte X-urile cu Client ID-ul tƒÉu LIVE -->
  <script src="https://www.paypal.com/sdk/js?client-id=AS9hdwsEsJqfIs0XUhQSQX1-itkthJ2NeNRp-3xIDfAs_oh6wi7PUeMbftDoIBc8WpHzXHUScQIgzLQvm&currency=GBP&intent=capture&components=buttons"></script>

  <style>
    :root { --brand:#0070ba; --ok:#28a745; --bg1:#f0f7ff; --bg2:#e6f2ff; --text:#333; --muted:#666; }
    *{box-sizing:border-box}
    body{
      font-family:"Segoe UI",Roboto,Arial,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
    }
    .card{background:#fff; width:100%; max-width:420px; padding:24px; border-radius:20px; box-shadow:0 6px 20px rgba(0,0,0,.1); text-align:center;}
    h1{color:var(--brand); margin:0 0 12px}
    .info{color:var(--muted); font-size:14px; margin:8px 0}
    label{display:block; text-align:left; margin:6px 0}
    input{width:100%; padding:12px; font-size:16px; border:1px solid #ccc; border-radius:12px; outline:none; color:var(--brand); font-weight:700;}
    input:focus{border-color:var(--brand); box-shadow:0 0 0 2px rgba(0,112,186,.2)}
    .price{font-size:22px; font-weight:700; color:var(--ok); margin:16px 0}
    .num{color:var(--brand); font-weight:700} /* cifre albastre */
    #paypal-button-container{margin-top:12px}
    .msg{margin-top:10px}
    .err{margin-top:10px; color:#b00020; white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="card">
    <h1>Parking Payment</h1>
    <h2 id="place">City Center (Z12) ‚Ä¢ Spot <span class="num">000</span></h2>
    <div class="info" id="rules">Min <span class="num">15</span> min ‚Ä¢ Max <span class="num">4</span> h ‚Ä¢ ¬£<span class="num">2</span>/hour</div>

    <label for="minutes">Duration (minutes):</label>
    <input id="minutes" type="number" value="60" min="15" step="15" />

    <div class="price">¬£<span id="amount">2.00</span></div>
    <div id="rounding" class="info">(rounded to <span class="num">1</span>h; chosen: <span class="num">60</span> min)</div>

    <div id="paypal-button-container"></div>
    <div id="pp-error" class="err"></div>
    <div id="msg" class="msg"></div>

    <div class="info">Operator: Parking-App</div>
  </div>

  <script>
    // ---- Config zonƒÉ (po»õi schimba) ----
    const ZONES = { Z12:{ name:"City Center", pricePerHourGBP:2, minMinutes:15, maxHours:4 } };

    // ---- Query params (?zone=Z12&spot=034) ----
    const p = new URLSearchParams(location.search);
    const zone = p.get("zone") || "Z12";
    const spot = p.get("spot") || "000";

    const $minutes = document.getElementById("minutes");
    const $amount  = document.getElementById("amount");
    const $round   = document.getElementById("rounding");
    const $place   = document.getElementById("place");
    const $rules   = document.getElementById("rules");
    const $err     = document.getElementById("pp-error");
    const $msg     = document.getElementById("msg");

    // √énvelim toate cifrele dintr-un text
    function colorNums(text){ return String(text).replace(/\d+/g, m => `<span class="num">${m}</span>`); }
    function setHTML(el, html){ el.innerHTML = html; }

    function refresh(){
      const z = ZONES[zone] || ZONES.Z12;
      const mins  = Math.max(parseInt($minutes.value||0), z.minMinutes);
      const hours = Math.ceil(mins/60);
      const value = (hours * z.pricePerHourGBP).toFixed(2);

      setHTML($place, `${z.name} (${zone}) ‚Ä¢ Spot ${colorNums(spot)}`);
      setHTML($rules, `Min ${colorNums(z.minMinutes)} min ‚Ä¢ Max ${colorNums(z.maxHours)} h ‚Ä¢ ¬£${colorNums(z.pricePerHourGBP)}/hour`);
      $amount.textContent = value; // suma e verde
      setHTML($round, `(rounded to ${colorNums(hours)}h; chosen: ${colorNums(mins)} min)`);
      return { value, mins, hours };
    }
    $minutes.addEventListener("input", refresh);
    refresh();

    // ---- PayPal ----
    if (window.paypal){
      paypal.Buttons({
        style:{layout:"vertical",color:"blue"},
        createOrder:(d,a)=>{
          const q = refresh();
          return a.order.create({
            purchase_units:[{ amount:{ value:q.value, currency_code:"GBP" },
              custom_id:`Z:${zone}|S:${spot}|M:${q.mins}` }]
          });
        },
        onApprove: async (d,a)=>{
          try { const details = await a.order.capture(); $msg.textContent = "‚úÖ Payment successful!"; }
          catch(e){ $err.textContent = "Confirm error: " + (e?.message||e); }
        },
        onError:(e)=>{ $err.textContent = "Error: " + (e?.message||e); }
      }).render("#paypal-button-container").catch(e=>{ $err.textContent = "Render error: " + e.message; });
    } else {
      $err.textContent = "‚ö†Ô∏è PayPal SDK did not load.";
    }
  </script>
</body>
</html>
