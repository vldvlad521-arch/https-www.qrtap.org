<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parking Payment</title>

  <!-- PayPal SDK cu Client ID-ul tău Live -->
  <script src="https://www.paypal.com/sdk/js?client-id=AS9hdwsEsJqfIs0XUhQSQX1-itkthJ2NeNRp-3xIDfAs_oh6wi7PUeMbftDoIBc8WpHzXHUScQIgzLQvm&currency=GBP&intent=capture&components=buttons"></script>

  <style>
    body {font-family: "Segoe UI", Arial, sans-serif; background:#f0f7ff; min-height:100vh; display:flex; align-items:center; justify-content:center; margin:0;}
    .card {background:#fff; padding:24px; border-radius:20px; box-shadow:0 6px 20px rgba(0,0,0,.1); max-width:420px; width:100%; text-align:center;}
    h1 {color:#0070ba; margin-bottom:12px;}
    .info {color:#666; font-size:14px; margin:8px 0;}
    input {width:100%; padding:12px; font-size:16px; border:1px solid #ccc; border-radius:12px; outline:none; color:#0070ba; font-weight:700;}
    .price {font-size:22px; font-weight:bold; color:#28a745; margin:16px 0;}
    .num {color:#0070ba; font-weight:700;}
    #paypal-button-container {margin-top:16px;}
    .msg {margin-top:12px; font-size:15px;}
    .err {margin-top:12px; color:#b00020; white-space:pre-wrap;}
  </style>
</head>
<body>
  <div class="card">
    <h1>Parking Payment</h1>
    <h2 id="place">City Center (Z12) • Spot <span class="num">000</span></h2>
    <div class="info" id="rules">Min <span class="num">15</span> min • Max <span class="num">4</span> h • £<span class="num">2</span>/hour</div>

    <label for="minutes">Duration (minutes):</label>
    <input id="minutes" type="number" value="60" min="15" step="15" />

    <div class="price">£<span id="amount">2.00</span></div>
    <div id="rounding" class="info">(rounded to <span class="num">1</span>h; chosen: <span class="num">60</span> min)</div>

    <div id="paypal-button-container"></div>
    <div id="pp-error" class="err"></div>
    <div id="msg" class="msg"></div>

    <div class="info">Operator: Parking-App</div>
  </div>

  <script>
    const zone = "Z12", spot = "000";
    const $minutes = document.getElementById("minutes");
    const $amount  = document.getElementById("amount");
    const $round   = document.getElementById("rounding");
    const $place   = document.getElementById("place");
    const $rules   = document.getElementById("rules");
    const $err     = document.getElementById("pp-error");
    const $msg     = document.getElementById("msg");

    function colorNums(text){ return String(text).replace(/\d+/g, m => `<span class="num">${m}</span>`); }
    function setHTML(el, html){ el.innerHTML = html; }

    function refresh(){
      const mins  = Math.max(parseInt($minutes.value||0),15);
      const hours = Math.ceil(mins/60);
      const value = (hours*2).toFixed(2); // £2/hour

      setHTML($place, `City Center (Z12) • Spot ${colorNums(spot)}`);
      setHTML($rules, `Min ${colorNums(15)} min • Max ${colorNums(4)} h • £${colorNums(2)}/hour`);
      $amount.textContent = value;
      setHTML($round, `(rounded to ${colorNums(hours)}h; chosen: ${colorNums(mins)} min)`);
      return { value, mins, hours };
    }
    $minutes.addEventListener("input", refresh);
    refresh();

    if (window.paypal){
      paypal.Buttons({
        style:{color:"blue",shape:"rect"},
        createOrder:(d,a)=>{
          const q=refresh();
          return a.order.create({purchase_units:[{amount:{value:q.value,currency_code:"GBP"}}]});
        },
        onApprove: async (d,a)=>{
          await a.order.capture();
          $msg.textContent="✅ Payment successful!";
        },
        onError:(e)=>{ $err.textContent="Error: "+(e?.message||e); }
      }).render("#paypal-button-container")
      .catch(e=>{ $err.textContent="Render error: "+e.message; });
    } else {
      $err.textContent="⚠️ PayPal SDK did not load.";
    }
  </script>
</body>
</html>
