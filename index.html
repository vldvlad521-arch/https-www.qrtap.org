<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Park Quick</title>
<style>
  :root{--pink:#f5007a;}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;margin:0;background:#f6f7fb;color:#111}
  .wrap{max-width:780px;margin:24px auto;padding:0 16px}
  h1{color:var(--pink);margin:8px 0 4px;font-size:40px}
  .muted{color:#505257}
  .card{background:#fff;border-radius:18px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,.06);margin:18px 0}
  .field{display:flex;flex-direction:column;gap:8px;margin:10px 0}
  .field label{font-weight:600}
  .field input,.field select{padding:14px 12px;border:1px solid #dcdde4;border-radius:12px;font-size:16px;background:#fff}
  .grid{display:grid;gap:12px}
  @media(min-width:680px){.grid-2{grid-template-columns:1fr 1fr}}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;white-space:nowrap}
  .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#f0f1f6;font-size:12px}
  .btn{border:0;border-radius:12px;padding:12px 16px;background:linear-gradient(90deg,#ff2f9e,var(--pink));color:#fff;cursor:pointer}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Park Quick</h1>
      <p class="muted">Datele se salvează local (LocalStorage). Pentru plăți reale ai nevoie de un procesator (Stripe/PayU/etc.).</p>
    </header>

    <section class="card">
      <h2 style="margin:0 0 8px;">Adaugă plată</h2>
      <form id="payForm" autocomplete="off">
        <div class="field">
          <label for="loc">Nr locație <span class="tag">preferențial</span></label>
          <input id="loc" name="loc" type="text" placeholder="ex. L1 / 101" />
        </div>

        <div class="field">
          <label for="car">Nr car</label>
          <input id="car" name="car" type="text" placeholder="B-99-ABC" required />
        </div>

        <div class="grid grid-2">
          <div class="field">
            <label for="timeValue">Timp</label>
            <input id="timeValue" name="timeValue" type="number" min="1" step="1" placeholder="Durată" required />
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <select id="timeUnit" name="timeUnit" required>
              <option value="minute">minute</option>
              <option value="ore">ore</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label for="card">Nr card</label>
          <input id="card" name="card" inputmode="numeric" pattern="[0-9 ]{12,23}" maxlength="19" placeholder="#### #### #### ####" required />
        </div>

        <div class="grid grid-2">
          <div class="field">
            <label for="exp">Exp</label>
            <input id="exp" name="exp" inputmode="numeric" placeholder="MM/YY" pattern="^(0[1-9]|1[0-2])\/\d{2}$" required />
          </div>
          <div class="field">
            <label for="cvv">CVV</label>
            <input id="cvv" name="cvv" inputmode="numeric" pattern="^\d{3,4}$" maxlength="4" placeholder="***" required />
          </div>
        </div>

        <div style="display:flex;justify-content:flex-end;margin-top:18px">
          <button class="btn" type="submit">Pay</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h3 style="margin:0 0 12px;">Plăți salvate local</h3>
      <div style="overflow:auto">
        <table id="table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Nr locație</th>
              <th>Nr car</th>
              <th>Timp</th>
              <th>Ultimele 4 cifre</th>
            </tr>
          </thead>
          <tbody id="tbody"><tr><td colspan="5" class="muted">Nu există înregistrări.</td></tr></tbody>
        </table>
      </div>
    </section>
  </div>

<script>
(function(){
  const KEY = "park_quick_payments_v2";
  const $ = s => document.querySelector(s);

  const formatCard = v => v.replace(/\D/g,'').slice(0,16).replace(/(.{4})/g,'$1 ').trim();
  const last4 = v => v.replace(/\D/g,'').slice(-4);

  // input masks
  $('#card').addEventListener('input', e => e.target.value = formatCard(e.target.value));
  $('#exp').addEventListener('input', e => {
    let v = e.target.value.replace(/\D/g,'').slice(0,4);
    if(v.length>2) v = v.slice(0,2) + '/' + v.slice(2);
    e.target.value = v;
  });

  function load(){ try { return JSON.parse(localStorage.getItem(KEY) || '[]'); } catch { return []; } }
  function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

  function render(){
    const data = load();
    const tbody = $('#tbody');
    tbody.innerHTML = '';
    if(!data.length){
      tbody.innerHTML = '<tr><td colspan="5" class="muted">Nu există înregistrări.</td></tr>';
      return;
    }
    data.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${new Date(r.createdAt).toLocaleString()}</td>
        <td>${r.loc || '-'}</td>
        <td>${r.car}</td>
        <td>${r.timeValue} ${r.timeUnit}</td>
        <td>${r.cardLast4}</td>`;
      tbody.appendChild(tr);
    });
  }

  $('#payForm').addEventListener('submit', e=>{
    e.preventDefault();

    const loc = $('#loc').value.trim();
    const car = $('#car').value.trim();
    const timeValue = parseInt($('#timeValue').value,10);
    const timeUnit = $('#timeUnit').value;
    const card = $('#card').value.trim();
    const exp = $('#exp').value.trim();
    const cvv = $('#cvv').value.trim();

    if(!car || !timeValue || !card || !exp || !cvv){
      alert('Completează câmpurile obligatorii.');
      return;
    }

    const record = {
      loc, car, timeValue, timeUnit,
      cardLast4: last4(card),
      createdAt: Date.now()
    };

    const data = load();
    data.unshift(record);
    save(data);
    render();

    e.target.reset();
    alert('Plata a fost SIMULATĂ și salvată local.');
  });

  render();
})();
</script>
</body>
</html>
