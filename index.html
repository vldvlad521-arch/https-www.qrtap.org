<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parking Payment</title>

  <!-- PayPal JS SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=IDVL85DM8VU8HDG&currency=GBP&intent=capture&components=buttons"></script>

  <style>
    body {
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #f0f7ff, #e6f2ff);
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .card {
      background: #fff;
      padding: 24px;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      max-width: 420px;
      width: 100%;
      text-align: center;
    }
    h1 {
      color: #0070ba;
      margin-bottom: 8px;
    }
    h2 {
      margin: 8px 0 20px;
      color: #333;
    }
    .info {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
    }
    input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 12px;
      outline: none;
    }
    input:focus {
      border-color: #0070ba;
      box-shadow: 0 0 0 2px rgba(0,112,186,0.2);
    }
    .price {
      font-size: 22px;
      font-weight: bold;
      color: #28a745;
      margin-bottom: 20px;
    }
    #paypal-button-container {
      margin-top: 16px;
    }
    .msg {
      margin-top: 16px;
      font-size: 15px;
      color: #333;
    }
    .contact {
      margin-top: 20px;
      font-size: 13px;
      color: #666;
    }
    .contact a {
      color: #0070ba;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Parking Payment</h1>
    <h2 id="place">Spot …</h2>
    <div class="info" id="rules">—</div>

    <label for="minutes">Duration (minutes):</label>
    <input id="minutes" type="number" min="15" step="15" value="60" />

    <div class="price">£<span id="amount">—</span></div>
    <div id="rounding" class="info"></div>

    <div id="paypal-button-container"></div>
    <div class="msg" id="msg"></div>

    <div class="contact">
      Operator contact: <a href="mailto:vldvlad521@gmail.com">vldvlad521@gmail.com</a>
    </div>
  </div>

  <script>
    // —— Parking zone settings ——
    const ZONES = {
      Z12: { name: "City Center", pricePerHourGBP: 2, minMinutes: 15, maxHours: 4 },
      Z99: { name: "Airport", pricePerHourGBP: 3, minMinutes: 30, maxHours: 24 }
    };

    // —— Read QR params (ex: ?zone=Z12&spot=034) ——
    const params = new URLSearchParams(location.search);
    const zone = params.get("zone") || "Z12";
    const spot = params.get("spot") || "000";

    const $place = document.getElementById("place");
    const $rules = document.getElementById("rules");
    const $minutes = document.getElementById("minutes");
    const $amount = document.getElementById("amount");
    const $rounding = document.getElementById("rounding");
    const $msg = document.getElementById("msg");

    function quote(zoneCode, minutesInput) {
      const z = ZONES[zoneCode];
      if (!z) return { value: "0.00", currency: "GBP", minutes: 0, hours: 0 };
      const minutes = Math.max(Number(minutesInput || 0), z.minMinutes);
      const hours = Math.ceil(minutes / 60);
      const value = (hours * z.pricePerHourGBP).toFixed(2);
      return { minutes, hours, value, currency: "GBP" };
    }

    function refresh() {
      const z = ZONES[zone];
      $place.textContent = `${z?.name || zone} (${zone}) • Spot ${spot}`;
      $rules.textContent = `Min ${z.minMinutes} min • Max ${z.maxHours} h • £${z.pricePerHourGBP}/hour`;

      const q = quote(zone, $minutes.value);
      $amount.textContent = q.value;
      $rounding.textContent = `(rounded to ${q.hours}h; chosen: ${q.minutes} min)`;
      return q;
    }

    $minutes.addEventListener("input", refresh);
    const q0 = refresh();

    // —— PayPal Buttons ——
    paypal.Buttons({
      style: { layout: "vertical", shape: "rect", color: "blue" },
      createOrder: (data, actions) => {
        const q = refresh();
        return actions.order.create({
          purchase_units: [{
            amount: { value: q.value, currency_code: q.currency },
            custom_id: `Z:${zone}|S:${spot}|M:${q.minutes}|E:bmrnicolae@gmail.com`
          }]
        });
      },
      onApprove: async (data, actions) => {
        const details = await actions.order.capture();
        $msg.textContent = "✅ Payment successful! Thank you!";
      },
      onError: (err) => {
        console.error(err);
        $msg.textContent = "❌ Payment error. Please try again.";
      }
    }).render("#paypal-button-container");
  </script>
</body>
</html>
